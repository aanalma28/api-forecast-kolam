<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - Fish Growth Forecasting API</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <i data-feather="trending-up" class="me-2"></i>
                Fish Growth Forecasting API
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/docs">API Documentation</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row">
            <!-- Sidebar Navigation -->
            <div class="col-lg-3">
                <div class="card border-0 bg-dark position-sticky" style="top: 2rem;">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i data-feather="list" class="me-2"></i>
                            Contents
                        </h5>
                    </div>
                    <div class="card-body">
                        <nav class="nav flex-column">
                            <a class="nav-link" href="#overview">Overview</a>
                            <a class="nav-link" href="#authentication">Authentication</a>
                            <a class="nav-link" href="#endpoints">Endpoints</a>
                            <a class="nav-link ps-3" href="#health">Health Check</a>
                            <a class="nav-link ps-3" href="#model-info">Model Info</a>
                            <a class="nav-link ps-3" href="#forecast">Generate Forecast</a>
                            <a class="nav-link ps-3" href="#batch-forecast">Batch Forecast</a>
                            <a class="nav-link" href="#examples">Examples</a>
                            <a class="nav-link" href="#errors">Error Handling</a>
                            <a class="nav-link" href="#rate-limiting">Rate Limiting</a>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Main Documentation Content -->
            <div class="col-lg-9">
                <!-- Overview -->
                <section id="overview" class="mb-5">
                    <h1 class="display-5 fw-bold mb-4">
                        <i data-feather="book-open" class="me-3"></i>
                        API Documentation
                    </h1>
                    <div class="card border-0 bg-dark">
                        <div class="card-body">
                            <p class="lead">
                                The Fish Growth Forecasting API provides specialized machine learning-powered fish growth prediction capabilities for aquaculture and fish farming operations.
                            </p>
                            <p>
                                This API is designed for fish farming applications that need to predict growth timelines until target weights are reached,
                                offering endpoints for single and batch predictions with comprehensive validation for fish farming data.
                            </p>
                            <div class="alert alert-info">
                                <i data-feather="info" class="me-2"></i>
                                <strong>Base URL:</strong> <code>http://localhost:5000/api</code>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Authentication -->
                <section id="authentication" class="mb-5">
                    <h2>
                        <i data-feather="lock" class="me-2"></i>
                        Authentication
                    </h2>
                    <div class="card border-0 bg-dark">
                        <div class="card-body">
                            <p>Currently, the API does not require authentication. All endpoints are publicly accessible.</p>
                            <div class="alert alert-warning">
                                <i data-feather="alert-triangle" class="me-2"></i>
                                <strong>Note:</strong> In production environments, proper authentication should be implemented.
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Endpoints -->
                <section id="endpoints" class="mb-5">
                    <h2>
                        <i data-feather="globe" class="me-2"></i>
                        API Endpoints
                    </h2>

                    <!-- Health Check -->
                    <div id="health" class="mb-4">
                        <div class="card border-0 bg-dark">
                            <div class="card-header">
                                <h4 class="card-title mb-0">
                                    <span class="badge bg-success me-2">GET</span>
                                    Health Check
                                </h4>
                            </div>
                            <div class="card-body">
                                <p><strong>Endpoint:</strong> <code>/api/health</code></p>
                                <p>Check the health status of the API and model.</p>
                                
                                <h6>Response:</h6>
                                <pre class="bg-secondary p-3 rounded"><code>{
  "status": "healthy",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "model_status": "trained",
  "version": "1.0.0"
}</code></pre>
                                
                                <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('/api/health', 'GET')">
                                    <i data-feather="play" class="me-1"></i>
                                    Test Endpoint
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Model Info -->
                    <div id="model-info" class="mb-4">
                        <div class="card border-0 bg-dark">
                            <div class="card-header">
                                <h4 class="card-title mb-0">
                                    <span class="badge bg-success me-2">GET</span>
                                    Model Information
                                </h4>
                            </div>
                            <div class="card-body">
                                <p><strong>Endpoint:</strong> <code>/api/model/info</code></p>
                                <p>Get information about the loaded forecasting model.</p>
                                
                                <h6>Response:</h6>
                                <pre class="bg-secondary p-3 rounded"><code>{
  "success": true,
  "data": {
    "model_type": "Fish Growth Forecasting Model (Placeholder)",
    "is_trained": true,
    "input_shape": "(batch_size, 7, 19)",
    "output_type": "Sequential weight predictions until target",
    "model_path": "data/fish_model.pkl",
    "note": "This is a placeholder implementation. Replace with your actual trained model."
  },
  "timestamp": "2024-01-01T12:00:00.000Z"
}</code></pre>
                                
                                <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('/api/model/info', 'GET')">
                                    <i data-feather="play" class="me-1"></i>
                                    Test Endpoint
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Forecast -->
                    <div id="forecast" class="mb-4">
                        <div class="card border-0 bg-dark">
                            <div class="card-header">
                                <h4 class="card-title mb-0">
                                    <span class="badge bg-primary me-2">POST</span>
                                    Generate Forecast
                                </h4>
                            </div>
                            <div class="card-body">
                                <p><strong>Endpoint:</strong> <code>/api/forecast</code></p>
                                <p>Generate fish growth predictions until target weight is reached.</p>
                                
                                <h6>Request Body:</h6>
                                <pre class="bg-secondary p-3 rounded"><code>{
  "target_weight": 1.2,        // Target weight in kg
  "sequence": [                // Array of daily fish data (min 7 days)
    {
      "date": "2024-01-01",
      "fish_type": "Nila",      // Nila, Mujair, or Gurame
      "start_weight": 0.22,     // Initial weight in kg
      "avg_weight": 0.26,       // Average weight in kg (excluded from features)
      "week_age": 1.0,          // Week age
      "pool_type": "A1"         // Optional: A1-A10 (defaults to A1)
    }
    // ... at least 7 days of data required
  ]
}</code></pre>

                                <h6>Response:</h6>
                                <pre class="bg-secondary p-3 rounded"><code>{
  "success": true,
  "data": {
    "predictions": [
      {
        "day": 1,
        "date": "2025-07-26",
        "predicted_weight": 0.8203,
        "days_to_target": null
      },
      {
        "day": 23,
        "date": "2025-08-17",
        "predicted_weight": 1.2084,
        "days_to_target": 23
      }
      // ... more daily predictions until target
    ],
    "summary": {
      "days_to_reach_target": 23,
      "target_weight": 1.2,
      "current_weight": 0.8,
      "final_predicted_weight": 1.2084,
      "target_reached": true,
      "total_predictions": 23
    },
    "metadata": {
      "model_type": "Fish Growth Forecast",
      "generated_at": "2024-01-01T12:00:00.000Z",
      "input_data": {
        "target_weight": 1.2,
        "sequence_length": 7,
        "sequences_shape": [1, 7, 19],
        "feature_columns": ["week_age", "start_weight(kg)", "day", "month", ...]
      },
      "model_info": {
        "model_type": "Placeholder Fish Growth Model",
        "note": "Replace this with your actual trained model"
      }
    }
  }
}</code></pre>
                                
                                <div class="mt-3">
                                    <button class="btn btn-sm btn-outline-primary" onclick="testForecastEndpoint()">
                                        <i data-feather="play" class="me-1"></i>
                                        Test Endpoint
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Batch Forecast -->
                    <div id="batch-forecast" class="mb-4">
                        <div class="card border-0 bg-dark">
                            <div class="card-header">
                                <h4 class="card-title mb-0">
                                    <span class="badge bg-primary me-2">POST</span>
                                    Batch Forecast
                                </h4>
                            </div>
                            <div class="card-body">
                                <p><strong>Endpoint:</strong> <code>/api/forecast/batch</code></p>
                                <p>Generate multiple fish growth forecasts in a single request (max 10 requests per batch).</p>
                                
                                <h6>Request Body:</h6>
                                <pre class="bg-secondary p-3 rounded"><code>{
  "requests": [
    {
      "target_weight": 1.0,
      "sequence": [
        {"date": "2024-01-01", "fish_type": "Nila", "start_weight": 0.2, "avg_weight": 0.25, "week_age": 1.0},
        // ... more sequence data
      ]
    },
    {
      "target_weight": 1.5,
      "sequence": [
        {"date": "2024-01-01", "fish_type": "Gurame", "start_weight": 0.15, "avg_weight": 0.20, "week_age": 2.0, "pool_type": "A5"},
        // ... more sequence data
      ]
    }
  ]
}</code></pre>

                                <h6>Response:</h6>
                                <pre class="bg-secondary p-3 rounded"><code>{
  "success": true,
  "data": {
    "results": [
      {
        "request_id": 0,
        "success": true,
        "data": {
          "predictions": [/* fish growth predictions array */],
          "summary": {
            "days_to_reach_target": 20,
            "target_weight": 1.0,
            "target_reached": true
          }
        }
      },
      {
        "request_id": 1,
        "success": true,
        "data": {
          "predictions": [/* fish growth predictions array */],
          "summary": {
            "days_to_reach_target": 35,
            "target_weight": 1.5,
            "target_reached": true
          }
        }
      }
    ],
    "total_requests": 2,
    "successful_requests": 2,
    "generated_at": "2024-01-01T12:00:00.000Z"
  }
}</code></pre>
                                
                                <button class="btn btn-sm btn-outline-primary" onclick="testBatchEndpoint()">
                                    <i data-feather="play" class="me-1"></i>
                                    Test Endpoint
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Examples -->
                <section id="examples" class="mb-5">
                    <h2>
                        <i data-feather="code" class="me-2"></i>
                        Usage Examples
                    </h2>
                    <div class="card border-0 bg-dark">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>JavaScript (Fetch)</h5>
                                    <pre class="bg-secondary p-3 rounded"><code>const response = await fetch('/api/forecast', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    target_weight: 1.2,
    sequence: [
      {
        date: "2024-01-01",
        fish_type: "Nila",
        start_weight: 0.22,
        avg_weight: 0.26,
        week_age: 1.0
      }
      // ... more sequence data (minimum 7 days)
    ]
  })
});

const data = await response.json();
console.log(`Days to reach target: ${data.data.summary.days_to_reach_target}`);</code></pre>
                                </div>
                                <div class="col-md-6">
                                    <h5>Python (requests)</h5>
                                    <pre class="bg-secondary p-3 rounded"><code>import requests

fish_data = {
    'target_weight': 1.2,
    'sequence': [
        {
            'date': '2024-01-01',
            'fish_type': 'Nila',
            'start_weight': 0.22,
            'avg_weight': 0.26,
            'week_age': 1.0,
            'pool_type': 'A1'
        }
        # ... more sequence data (minimum 7 days)
    ]
}

response = requests.post('/api/forecast', json=fish_data)
data = response.json()

if data['success']:
    summary = data['data']['summary']
    print(f"Days to reach {summary['target_weight']}kg: {summary['days_to_reach_target']}")
    print(f"Target reached: {summary['target_reached']}")
else:
    print(f"Error: {data['error']}")</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Error Handling -->
                <section id="errors" class="mb-5">
                    <h2>
                        <i data-feather="alert-circle" class="me-2"></i>
                        Error Handling
                    </h2>
                    <div class="card border-0 bg-dark">
                        <div class="card-body">
                            <p>The API returns standardized error responses for various failure scenarios:</p>
                            
                            <h6>Validation Error (400):</h6>
                            <pre class="bg-secondary p-3 rounded"><code>{
  "success": false,
  "error": "Validation failed",
  "details": ["periods must be at least 1"],
  "status": 400
}</code></pre>

                            <h6>Rate Limit Error (429):</h6>
                            <pre class="bg-secondary p-3 rounded"><code>{
  "error": "Rate limit exceeded",
  "message": "Maximum 100 requests per hour allowed",
  "status": 429
}</code></pre>

                            <h6>Server Error (500):</h6>
                            <pre class="bg-secondary p-3 rounded"><code>{
  "success": false,
  "error": "Internal server error",
  "message": "Failed to generate forecast predictions",
  "status": 500
}</code></pre>
                        </div>
                    </div>
                </section>

                <!-- Rate Limiting -->
                <section id="rate-limiting" class="mb-5">
                    <h2>
                        <i data-feather="clock" class="me-2"></i>
                        Rate Limiting
                    </h2>
                    <div class="card border-0 bg-dark">
                        <div class="card-body">
                            <p>The API implements rate limiting to ensure fair usage:</p>
                            <ul>
                                <li><strong>Limit:</strong> 100 requests per hour per IP address</li>
                                <li><strong>Window:</strong> Rolling 1-hour window</li>
                                <li><strong>Response:</strong> HTTP 429 when limit exceeded</li>
                            </ul>
                            <div class="alert alert-info">
                                <i data-feather="info" class="me-2"></i>
                                Rate limits are applied per client IP address and reset every hour.
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <footer class="border-top py-4 mt-5">
        <div class="container text-center text-muted">
            <p>&copy; 2024 Fish Growth Forecasting API. Built with Flask, scikit-learn, and Bootstrap for aquaculture applications.</p>
        </div>
    </footer>

    <!-- API Test Results Modal -->
    <div class="modal fade" id="apiTestModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark border-0">
                <div class="modal-header border-bottom border-secondary">
                    <h5 class="modal-title">API Test Result</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="apiTestResult"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.29.0/dist/feather.min.js"></script>
    <script src="{{ url_for('static', filename='js/api-client.js') }}"></script>
    <script>
        // Initialize Feather icons
        feather.replace();
        
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        async function testEndpoint(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(endpoint, options);
                const data = await response.json();
                
                showTestResult(endpoint, method, response.status, data);
            } catch (error) {
                showTestResult(endpoint, method, 'Error', { error: error.message });
            }
        }
        
        function testForecastEndpoint() {
            const body = {
                target_weight: 1.2,
                sequence: [
                    {date: "2024-01-01", fish_type: "Nila", start_weight: 0.22, avg_weight: 0.26, week_age: 1.0},
                    {date: "2024-01-02", fish_type: "Nila", start_weight: 0.22, avg_weight: 0.32, week_age: 1.0},
                    {date: "2024-01-03", fish_type: "Nila", start_weight: 0.22, avg_weight: 0.40, week_age: 1.0},
                    {date: "2024-01-04", fish_type: "Nila", start_weight: 0.22, avg_weight: 0.51, week_age: 1.0},
                    {date: "2024-01-05", fish_type: "Nila", start_weight: 0.22, avg_weight: 0.60, week_age: 1.0},
                    {date: "2024-01-06", fish_type: "Nila", start_weight: 0.22, avg_weight: 0.70, week_age: 1.0},
                    {date: "2024-01-07", fish_type: "Nila", start_weight: 0.22, avg_weight: 0.80, week_age: 1.0}
                ]
            };
            testEndpoint('/api/forecast', 'POST', body);
        }
        
        function testBatchEndpoint() {
            const body = {
                requests: [
                    {
                        target_weight: 1.0,
                        sequence: [
                            {date: "2024-01-01", fish_type: "Nila", start_weight: 0.2, avg_weight: 0.25, week_age: 1.0},
                            {date: "2024-01-02", fish_type: "Nila", start_weight: 0.2, avg_weight: 0.30, week_age: 1.0},
                            {date: "2024-01-03", fish_type: "Nila", start_weight: 0.2, avg_weight: 0.35, week_age: 1.0},
                            {date: "2024-01-04", fish_type: "Nila", start_weight: 0.2, avg_weight: 0.40, week_age: 1.0},
                            {date: "2024-01-05", fish_type: "Nila", start_weight: 0.2, avg_weight: 0.45, week_age: 1.0},
                            {date: "2024-01-06", fish_type: "Nila", start_weight: 0.2, avg_weight: 0.50, week_age: 1.0},
                            {date: "2024-01-07", fish_type: "Nila", start_weight: 0.2, avg_weight: 0.55, week_age: 1.0}
                        ]
                    },
                    {
                        target_weight: 1.5,
                        sequence: [
                            {date: "2024-01-01", fish_type: "Gurame", start_weight: 0.15, avg_weight: 0.20, week_age: 2.0, pool_type: "A5"},
                            {date: "2024-01-02", fish_type: "Gurame", start_weight: 0.15, avg_weight: 0.25, week_age: 2.0, pool_type: "A5"},
                            {date: "2024-01-03", fish_type: "Gurame", start_weight: 0.15, avg_weight: 0.30, week_age: 2.0, pool_type: "A5"},
                            {date: "2024-01-04", fish_type: "Gurame", start_weight: 0.15, avg_weight: 0.35, week_age: 2.0, pool_type: "A5"},
                            {date: "2024-01-05", fish_type: "Gurame", start_weight: 0.15, avg_weight: 0.40, week_age: 2.0, pool_type: "A5"},
                            {date: "2024-01-06", fish_type: "Gurame", start_weight: 0.15, avg_weight: 0.45, week_age: 2.0, pool_type: "A5"},
                            {date: "2024-01-07", fish_type: "Gurame", start_weight: 0.15, avg_weight: 0.50, week_age: 2.0, pool_type: "A5"}
                        ]
                    }
                ]
            };
            testEndpoint('/api/forecast/batch', 'POST', body);
        }
        
        function showTestResult(endpoint, method, status, data) {
            const resultDiv = document.getElementById('apiTestResult');
            const statusClass = status >= 200 && status < 300 ? 'success' : 'danger';
            
            resultDiv.innerHTML = `
                <div class="mb-3">
                    <h6><strong>${method}</strong> ${endpoint}</h6>
                    <span class="badge bg-${statusClass}">Status: ${status}</span>
                </div>
                <pre class="bg-secondary p-3 rounded" style="max-height: 400px; overflow-y: auto;"><code>${JSON.stringify(data, null, 2)}</code></pre>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('apiTestModal'));
            modal.show();
        }
    </script>
</body>
</html>
